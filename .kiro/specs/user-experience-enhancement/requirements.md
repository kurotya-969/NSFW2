# 要件定義書：ユーザーエクスペリエンス強化機能

## はじめに

このドキュメントでは、麻理AIチャットアプリケーションのユーザーエクスペリエンスを向上させるための新機能について定義します。主な機能は以下の3つです：

1. 親密度の視覚的表示と段階変化通知
2. 重要な会話内容（ユーザー情報）の保存と活用
3. ユーザー統計情報の収集と分析

これらの機能により、ユーザーとの関係性をより深め、パーソナライズされた体験を提供することを目指します。

## 要件

### 要件1：親密度の視覚的表示と段階変化通知

**ユーザーストーリー:** ユーザーとして、麻理との親密度を視覚的に確認でき、関係性の変化を実感したいです。

#### 受け入れ基準

1. WHEN ユーザーがチャット画面を表示する THEN システムはUIに親密度ゲージを表示する
2. WHEN 親密度ゲージが表示される THEN システムは現在の親密度レベル（0-100）を視覚的に表現する
3. WHEN 親密度レベルが変化する THEN システムはゲージをアニメーションで更新する
4. WHEN 親密度が段階の閾値を超える（例：65→66で「friendly」から「warm」へ） THEN システムは特別なメッセージを表示する
5. WHEN 特別なメッセージが表示される THEN システムは麻理のキャラクターに合った反応を示す
6. WHEN ユーザーが「セッション情報」アコーディオンを開く THEN システムは詳細な関係性ステージ情報を表示する
7. IF ユーザーが初めてアプリを使用する THEN システムはチュートリアルで親密度システムについて説明する

### 要件2：重要な会話内容の保存と活用

**ユーザーストーリー:** ユーザーとして、以前の会話で共有した個人的な情報（好みや誕生日など）を麻理が覚えていて、会話に活用してくれることを期待します。

#### 受け入れ基準

1. WHEN ユーザーが重要な個人情報（好きなもの、誕生日、名前など）を会話で共有する THEN システムはその情報を検出して保存する
2. WHEN 重要な情報が検出される THEN システムはユーザーセッションのメタデータとして情報を関連付ける
3. WHEN 麻理がユーザーと会話する THEN システムは保存された情報を文脈に応じて会話に組み込む
4. WHEN 麻理が保存情報を初めて使用する THEN システムは自然な形で「覚えている」ことを示す
5. IF ユーザーが情報を修正する THEN システムは保存された情報を更新する
6. IF 保存された情報が古くなる（例：季節の好みが夏から冬に変わるなど） THEN システムは確認のための質問を会話に組み込む

### 要件3：ユーザー統計情報の収集と分析

**ユーザーストーリー:** 管理者として、アプリケーションの使用状況を把握し、ユーザーエンゲージメントを分析したいです。

#### 受け入れ基準

1. WHEN ユーザーがアプリケーションを使用する THEN システムはセッションIDを記録する
2. WHEN 新しいセッションが作成される THEN システムは日付とタイムスタンプを記録する
3. WHEN 管理者が統計情報を要求する THEN システムは日別のユニークユーザー数を表示する
4. WHEN 管理者が統計情報を要求する THEN システムは時間帯別のアクティビティ分布を表示する
5. WHEN 管理者が統計情報を要求する THEN システムは平均セッション時間と会話ターン数を表示する
6. IF 管理者が特定の期間の統計を要求する THEN システムはその期間のデータをフィルタリングして表示する
7. IF 管理者がデータをエクスポートする THEN システムはCSV形式でデータを提供する